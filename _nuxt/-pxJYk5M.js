var ce=Object.defineProperty;var K=s=>{throw TypeError(s)};var le=(s,t,e)=>t in s?ce(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var U=(s,t,e)=>le(s,typeof t!="symbol"?t+"":t,e),G=(s,t,e)=>t.has(s)||K("Cannot "+e);var r=(s,t,e)=>(G(s,t,"read from private field"),e?e.call(s):t.get(s)),g=(s,t,e)=>t.has(s)?K("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),v=(s,t,e,n)=>(G(s,t,"write to private field"),n?n.call(s,e):t.set(s,e),e),b=(s,t,e)=>(G(s,t,"access private method"),e);var V=(s,t,e,n)=>({set _(h){v(s,t,h,e)},get _(){return r(s,t,n)}});import{aj as he,ak as fe,ag as de,I as ve,r as W,ai as X,F as me}from"./uPkiCNGO.js";const pe=he(),ye=()=>pe,we=new AbortController,ge=()=>we;var ee={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function h(c,a,i){this.fn=c,this.context=a,this.once=i||!1}function w(c,a,i,u,d){if(typeof i!="function")throw new TypeError("The listener must be a function");var E=new h(i,u||c,d),m=e?e+a:a;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],E]:c._events[m].push(E):(c._events[m]=E,c._eventsCount++),c}function p(c,a){--c._eventsCount===0?c._events=new n:delete c._events[a]}function f(){this._events=new n,this._eventsCount=0}f.prototype.eventNames=function(){var a=[],i,u;if(this._eventsCount===0)return a;for(u in i=this._events)t.call(i,u)&&a.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(i)):a},f.prototype.listeners=function(a){var i=e?e+a:a,u=this._events[i];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,E=u.length,m=new Array(E);d<E;d++)m[d]=u[d].fn;return m},f.prototype.listenerCount=function(a){var i=e?e+a:a,u=this._events[i];return u?u.fn?1:u.length:0},f.prototype.emit=function(a,i,u,d,E,m){var T=e?e+a:a;if(!this._events[T])return!1;var o=this._events[T],O=arguments.length,N,y;if(o.fn){switch(o.once&&this.removeListener(a,o.fn,void 0,!0),O){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,i),!0;case 3:return o.fn.call(o.context,i,u),!0;case 4:return o.fn.call(o.context,i,u,d),!0;case 5:return o.fn.call(o.context,i,u,d,E),!0;case 6:return o.fn.call(o.context,i,u,d,E,m),!0}for(y=1,N=new Array(O-1);y<O;y++)N[y-1]=arguments[y];o.fn.apply(o.context,N)}else{var ue=o.length,D;for(y=0;y<ue;y++)switch(o[y].once&&this.removeListener(a,o[y].fn,void 0,!0),O){case 1:o[y].fn.call(o[y].context);break;case 2:o[y].fn.call(o[y].context,i);break;case 3:o[y].fn.call(o[y].context,i,u);break;case 4:o[y].fn.call(o[y].context,i,u,d);break;default:if(!N)for(D=1,N=new Array(O-1);D<O;D++)N[D-1]=arguments[D];o[y].fn.apply(o[y].context,N)}}return!0},f.prototype.on=function(a,i,u){return w(this,a,i,u,!1)},f.prototype.once=function(a,i,u){return w(this,a,i,u,!0)},f.prototype.removeListener=function(a,i,u,d){var E=e?e+a:a;if(!this._events[E])return this;if(!i)return p(this,E),this;var m=this._events[E];if(m.fn)m.fn===i&&(!d||m.once)&&(!u||m.context===u)&&p(this,E);else{for(var T=0,o=[],O=m.length;T<O;T++)(m[T].fn!==i||d&&!m[T].once||u&&m[T].context!==u)&&o.push(m[T]);o.length?this._events[E]=o.length===1?o[0]:o:p(this,E)}return this},f.prototype.removeAllListeners=function(a){var i;return a?(i=e?e+a:a,this._events[i]&&p(this,i)):(this._events=new n,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=e,f.EventEmitter=f,s.exports=f})(ee);var be=ee.exports;const Ee=fe(be);class te extends Error{constructor(t){super(t),this.name="TimeoutError"}}class Ie extends Error{constructor(t){super(),this.name="AbortError",this.message=t}}const Z=s=>globalThis.DOMException===void 0?new Ie(s):new DOMException(s),j=s=>{const t=s.reason===void 0?Z("This operation was aborted."):s.reason;return t instanceof Error?t:Z(t)};function xe(s,t){const{milliseconds:e,fallback:n,message:h,customTimers:w={setTimeout,clearTimeout}}=t;let p;const c=new Promise((a,i)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(t.signal){const{signal:d}=t;d.aborted&&i(j(d)),d.addEventListener("abort",()=>{i(j(d))})}if(e===Number.POSITIVE_INFINITY){s.then(a,i);return}const u=new te;p=w.setTimeout.call(void 0,()=>{if(n){try{a(n())}catch(d){i(d)}return}typeof s.cancel=="function"&&s.cancel(),h===!1?a():h instanceof Error?i(h):(u.message=h??`Promise timed out after ${e} milliseconds`,i(u))},e),(async()=>{try{a(await s)}catch(d){i(d)}})()}).finally(()=>{c.clear()});return c.clear=()=>{w.clearTimeout.call(void 0,p),p=void 0},c}function Ce(s,t,e){let n=0,h=s.length;for(;h>0;){const w=Math.trunc(h/2);let p=n+w;e(s[p],t)<=0?(n=++p,h-=w+1):h=w}return n}var _;class _e{constructor(){g(this,_,[])}enqueue(t,e){e={priority:0,...e};const n={priority:e.priority,run:t};if(this.size&&r(this,_)[this.size-1].priority>=e.priority){r(this,_).push(n);return}const h=Ce(r(this,_),n,(w,p)=>p.priority-w.priority);r(this,_).splice(h,0,n)}dequeue(){const t=r(this,_).shift();return t==null?void 0:t.run}filter(t){return r(this,_).filter(e=>e.priority===t.priority).map(e=>e.run)}get size(){return r(this,_).length}}_=new WeakMap;var S,z,A,F,L,k,x,q,I,R,C,$,P,M,l,re,ne,se,ie,ae,Y,H,J,Q,oe,B;class Te extends Ee{constructor(e){var n,h;super();g(this,l);g(this,S);g(this,z);g(this,A,0);g(this,F);g(this,L);g(this,k,0);g(this,x);g(this,q);g(this,I);g(this,R);g(this,C,0);g(this,$);g(this,P);g(this,M);U(this,"timeout");if(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:_e,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=e.intervalCap)==null?void 0:n.toString())??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((h=e.interval)==null?void 0:h.toString())??""}\` (${typeof e.interval})`);v(this,S,e.carryoverConcurrencyCount),v(this,z,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0),v(this,F,e.intervalCap),v(this,L,e.interval),v(this,I,new e.queueClass),v(this,R,e.queueClass),this.concurrency=e.concurrency,this.timeout=e.timeout,v(this,M,e.throwOnTimeout===!0),v(this,P,e.autoStart===!1)}get concurrency(){return r(this,$)}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);v(this,$,e),b(this,l,Q).call(this)}async add(e,n={}){return n={timeout:this.timeout,throwOnTimeout:r(this,M),...n},new Promise((h,w)=>{r(this,I).enqueue(async()=>{var p;V(this,C)._++,V(this,A)._++;try{(p=n.signal)==null||p.throwIfAborted();let f=e({signal:n.signal});n.timeout&&(f=xe(Promise.resolve(f),{milliseconds:n.timeout})),n.signal&&(f=Promise.race([f,b(this,l,oe).call(this,n.signal)]));const c=await f;h(c),this.emit("completed",c)}catch(f){if(f instanceof te&&!n.throwOnTimeout){h();return}w(f),this.emit("error",f)}finally{b(this,l,se).call(this)}},n),this.emit("add"),b(this,l,Y).call(this)})}async addAll(e,n){return Promise.all(e.map(async h=>this.add(h,n)))}start(){return r(this,P)?(v(this,P,!1),b(this,l,Q).call(this),this):this}pause(){v(this,P,!0)}clear(){v(this,I,new(r(this,R)))}async onEmpty(){r(this,I).size!==0&&await b(this,l,B).call(this,"empty")}async onSizeLessThan(e){r(this,I).size<e||await b(this,l,B).call(this,"next",()=>r(this,I).size<e)}async onIdle(){r(this,C)===0&&r(this,I).size===0||await b(this,l,B).call(this,"idle")}get size(){return r(this,I).size}sizeBy(e){return r(this,I).filter(e).length}get pending(){return r(this,C)}get isPaused(){return r(this,P)}}S=new WeakMap,z=new WeakMap,A=new WeakMap,F=new WeakMap,L=new WeakMap,k=new WeakMap,x=new WeakMap,q=new WeakMap,I=new WeakMap,R=new WeakMap,C=new WeakMap,$=new WeakMap,P=new WeakMap,M=new WeakMap,l=new WeakSet,re=function(){return r(this,z)||r(this,A)<r(this,F)},ne=function(){return r(this,C)<r(this,$)},se=function(){V(this,C)._--,b(this,l,Y).call(this),this.emit("next")},ie=function(){b(this,l,J).call(this),b(this,l,H).call(this),v(this,q,void 0)},ae=function(){const e=Date.now();if(r(this,x)===void 0){const n=r(this,k)-e;if(n<0)v(this,A,r(this,S)?r(this,C):0);else return r(this,q)===void 0&&v(this,q,setTimeout(()=>{b(this,l,ie).call(this)},n)),!0}return!1},Y=function(){if(r(this,I).size===0)return r(this,x)&&clearInterval(r(this,x)),v(this,x,void 0),this.emit("empty"),r(this,C)===0&&this.emit("idle"),!1;if(!r(this,P)){const e=!r(this,l,ae);if(r(this,l,re)&&r(this,l,ne)){const n=r(this,I).dequeue();return n?(this.emit("active"),n(),e&&b(this,l,H).call(this),!0):!1}}return!1},H=function(){r(this,z)||r(this,x)!==void 0||(v(this,x,setInterval(()=>{b(this,l,J).call(this)},r(this,L))),v(this,k,Date.now()+r(this,L)))},J=function(){r(this,A)===0&&r(this,C)===0&&r(this,x)&&(clearInterval(r(this,x)),v(this,x,void 0)),v(this,A,r(this,S)?r(this,C):0),b(this,l,Q).call(this)},Q=function(){for(;b(this,l,Y).call(this););},oe=async function(e){return new Promise((n,h)=>{e.addEventListener("abort",()=>{h(e.reason)},{once:!0})})},B=async function(e,n){return new Promise(h=>{const w=()=>{n&&!n()||(this.off(e,w),h())};this.on(e,w)})};const Ae=de("pgcr",()=>{const s=ve(),t=ye(),e=ge(),n=new Te({concurrency:8}),h=W(!1);n.on("idle",()=>h.value=!0);const w=()=>{p.value=0,n.clear(),s.clear()},p=W(0);return{clear:w,fetchReport:c=>{const a=async()=>{p.value++;const i=await me(c,t);s.insertEncounters(i)};n.add(()=>a(),{signal:e.signal}),h.value=!1},fetchedCount:X(p),idle:X(h)}});export{ge as a,ye as b,Ae as u};
